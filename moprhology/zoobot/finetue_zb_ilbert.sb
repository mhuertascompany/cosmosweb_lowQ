#!/bin/bash
#SBATCH --job-name=cosmos_finetune
#SBATCH --output=/n03data/huertas/COSMOS-Web/ilbert_finetune/zoobot.out
#SBATCH --error=/n03data/huertas/COSMOS-Web/ilbert_finetune/zoobot.err
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --nodelist=n03
#SBATCH --cpus-per-task=4
#SBATCH --time=48:00:00
#SBATCH --gres=gpu:1


source /n03data/huertas/python/miniconda3/etc/profile.d/conda.sh
conda activate /n03data/huertas/python/miniconda3/envs/cosmos_visual/

cd /n03data/huertas/python/cosmosweb_lowQ


#hf_hub:mwalmsley/zoobot-encoder-convnext_nano
python /n03data/huertas/python/cosmosweb_lowQ/moprhology/zoobot/train_on_cosmos_visual.py --stamp-dir /n03data/huertas/COSMOS-Web/zoobot/stamps_ilbert --visual-labels /n07data/ilbert/COSMOS-Web/photoz_MASTER_v3.1.0/MORPHO/visualmorpho_COSMOSWeb_v7.db --redshift-table /n07data/ilbert/COSMOS-Web/photoz_MASTER_v3.1.0/MORPHO/COSMOSWeb_mastercatalog_v1.fits --redshift-value-column zfinal --redshift-id-column id --sqlite-table morphology --filter-name rest-frame --save-dir /n03data/huertas/COSMOS-Web/zoobot/models/ilbert_finetune --prediction-csv /n03data/huertas/COSMOS-Web/ilbert_finetune/test_set_euclid_binary.csv --accelerator gpu --devices 1 --encoder-name  hf_hub:mwalmsley/zoobot-encoder-euclid --export-splits-dir /n03data/huertas/COSMOS-Web/ilbert_finetune/binary/ --label-set binary --use-class-weights --majority-ratio 2 

